import{j as X,h as Z,k as ve,e as pe,r as ye,E as ge,_ as le}from"./base-21f85690.js";import{a as be,E as Ce}from"./el-form-item-7906de54.js";import{E as he}from"./el-input-b8aa941d.js";import{E as Ee}from"./el-button-3fc5268f.js";import{c as we}from"./index-2689b08d.js";import{$ as ke,N as ne,s as Te,O as _e,a0 as Me,j as G,a as F,a1 as se,l as K,a2 as Be,a3 as H,b as J,g as U,d as R,m as g,G as M,A as Ie,u as Se,i as Q,o as O,c as Y,q as z,p as S,f as o,t as ae,w as y,e as W,r as De,v as x,K as re,a4 as Fe,a5 as $e,k as D,a6 as Le,a7 as Pe,V as Ae,y as Oe,S as ee,J as Ne,z as Ve,Q as ze,H as Re,a8 as Ye,R as Ue,T as He,a9 as je,D as qe,M as oe,F as Xe,E as j}from"./index-70c8f837.js";import{P as q}from"./vnode-cd99ac2e.js";import{i as Ke,C as We,u as te}from"./constants-f489c7ba.js";import{F as xe,a as Ge,E as Je}from"./focus-trap-17d96c98.js";import{U as ie}from"./event-9519ab40.js";import{t as Ze}from"./typescript-ac073a9a.js";import{g as Qe}from"./scroll-0f198e54.js";import{u as eo}from"./use-form-item-e75f82ec.js";import"./_Uint8Array-85d7e347.js";import"./index-f8748455.js";const oo=(...e)=>t=>{e.forEach(l=>{ke(l)?l(t):l.value=t})},to=(e,t,l,m)=>{let s={offsetX:0,offsetY:0};const d=c=>{const r=c.clientX,f=c.clientY,{offsetX:v,offsetY:b}=s,p=e.value.getBoundingClientRect(),u=p.left,T=p.top,_=p.width,N=p.height,B=document.documentElement.clientWidth,I=document.documentElement.clientHeight,w=-u+v,V=-T+b,$=B-u-_+v,L=I-T-N+b,k=n=>{let C=v+n.clientX-r,h=b+n.clientY-f;m!=null&&m.value||(C=Math.min(Math.max(C,w),$),h=Math.min(Math.max(h,V),L)),s={offsetX:C,offsetY:h},e.value&&(e.value.style.transform=`translate(${X(C)}, ${X(h)})`)},P=()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",P)};document.addEventListener("mousemove",k),document.addEventListener("mouseup",P)},i=()=>{t.value&&e.value&&t.value.addEventListener("mousedown",d)},a=()=>{t.value&&e.value&&t.value.removeEventListener("mousedown",d)};ne(()=>{Te(()=>{l.value?i():a()})}),_e(()=>{a()})},lo=(e,t={})=>{Me(e)||Ze("[useLockscreen]","You need to pass a ref param to this function");const l=t.ns||G("popup"),m=F(()=>l.bm("parent","hidden"));if(!se||Z(document.body,m.value))return;let s=0,d=!1,i="0";const a=()=>{setTimeout(()=>{ye(document==null?void 0:document.body,m.value),d&&document&&(document.body.style.width=i)},200)};K(e,c=>{if(!c){a();return}d=!Z(document.body,m.value),d&&(i=document.body.style.width),s=Qe(l.namespace.value);const r=document.documentElement.clientHeight<document.body.scrollHeight,f=ve(document.body,"overflowY");s>0&&(r||f==="scroll")&&d&&(document.body.style.width=`calc(100% - ${s}px)`),pe(document.body,m.value)}),Be(()=>a())},ue=e=>{if(!e)return{onClick:H,onMousedown:H,onMouseup:H};let t=!1,l=!1;return{onClick:i=>{t&&l&&e(i),t=l=!1},onMousedown:i=>{t=i.target===i.currentTarget},onMouseup:i=>{l=i.target===i.currentTarget}}},no=J({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:U([String,Array,Object])},zIndex:{type:U([String,Number])}}),so={click:e=>e instanceof MouseEvent},ao="overlay";var ro=R({name:"ElOverlay",props:no,emits:so,setup(e,{slots:t,emit:l}){const m=G(ao),s=c=>{l("click",c)},{onClick:d,onMousedown:i,onMouseup:a}=ue(e.customMaskEvent?void 0:s);return()=>e.mask?g("div",{class:[m.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:d,onMousedown:i,onMouseup:a},[M(t,"default")],q.STYLE|q.CLASS|q.PROPS,["onClick","onMouseup","onMousedown"]):Ie("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[M(t,"default")])}});const io=ro,de=Symbol("dialogInjectionKey"),ce=J({center:Boolean,alignCenter:Boolean,closeIcon:{type:Ke},draggable:Boolean,overflow:Boolean,fullscreen:Boolean,showClose:{type:Boolean,default:!0},title:{type:String,default:""},ariaLevel:{type:String,default:"2"}}),uo={close:()=>!0},co=["aria-level"],fo=["aria-label"],mo=["id"],vo=R({name:"ElDialogContent"}),po=R({...vo,props:ce,emits:uo,setup(e){const t=e,{t:l}=Se(),{Close:m}=We,{dialogRef:s,headerRef:d,bodyId:i,ns:a,style:c}=Q(de),{focusTrapRef:r}=Q(xe),f=F(()=>[a.b(),a.is("fullscreen",t.fullscreen),a.is("draggable",t.draggable),a.is("align-center",t.alignCenter),{[a.m("center")]:t.center}]),v=oo(r,s),b=F(()=>t.draggable),p=F(()=>t.overflow);return to(s,d,b,p),(u,T)=>(O(),Y("div",{ref:o(v),class:S(o(f)),style:re(o(c)),tabindex:"-1"},[z("header",{ref_key:"headerRef",ref:d,class:S([o(a).e("header"),{"show-close":u.showClose}])},[M(u.$slots,"header",{},()=>[z("span",{role:"heading","aria-level":u.ariaLevel,class:S(o(a).e("title"))},ae(u.title),11,co)]),u.showClose?(O(),Y("button",{key:0,"aria-label":o(l)("el.dialog.close"),class:S(o(a).e("headerbtn")),type:"button",onClick:T[0]||(T[0]=_=>u.$emit("close"))},[g(o(ge),{class:S(o(a).e("close"))},{default:y(()=>[(O(),W(De(u.closeIcon||o(m))))]),_:1},8,["class"])],10,fo)):x("v-if",!0)],2),z("div",{id:o(i),class:S(o(a).e("body"))},[M(u.$slots,"default")],10,mo),u.$slots.footer?(O(),Y("footer",{key:0,class:S(o(a).e("footer"))},[M(u.$slots,"footer")],2)):x("v-if",!0)],6))}});var yo=le(po,[["__file","dialog-content.vue"]]);const go=J({...ce,appendToBody:Boolean,appendTo:{type:U(String),default:"body"},beforeClose:{type:U(Function)},destroyOnClose:Boolean,closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:Boolean,modalClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:{type:Boolean,default:!1},headerAriaLevel:{type:String,default:"2"}}),bo={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[ie]:e=>Fe(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},Co=(e,t)=>{var l;const s=Oe().emit,{nextZIndex:d}=$e();let i="";const a=te(),c=te(),r=D(!1),f=D(!1),v=D(!1),b=D((l=e.zIndex)!=null?l:d());let p,u;const T=Le("namespace",Pe),_=F(()=>{const E={},A=`--${T.value}-dialog`;return e.fullscreen||(e.top&&(E[`${A}-margin-top`]=e.top),e.width&&(E[`${A}-width`]=X(e.width))),E}),N=F(()=>e.alignCenter?{display:"flex"}:{});function B(){s("opened")}function I(){s("closed"),s(ie,!1),e.destroyOnClose&&(v.value=!1)}function w(){s("close")}function V(){u==null||u(),p==null||p(),e.openDelay&&e.openDelay>0?{stop:p}=ee(()=>P(),e.openDelay):P()}function $(){p==null||p(),u==null||u(),e.closeDelay&&e.closeDelay>0?{stop:u}=ee(()=>n(),e.closeDelay):n()}function L(){function E(A){A||(f.value=!0,r.value=!1)}e.beforeClose?e.beforeClose(E):$()}function k(){e.closeOnClickModal&&L()}function P(){se&&(r.value=!0)}function n(){r.value=!1}function C(){s("openAutoFocus")}function h(){s("closeAutoFocus")}function fe(E){var A;((A=E.detail)==null?void 0:A.focusReason)==="pointer"&&E.preventDefault()}e.lockScroll&&lo(r);function me(){e.closeOnPressEscape&&L()}return K(()=>e.modelValue,E=>{E?(f.value=!1,V(),v.value=!0,b.value=Ge(e.zIndex)?d():b.value++,Ae(()=>{s("open"),t.value&&(t.value.scrollTop=0)})):r.value&&$()}),K(()=>e.fullscreen,E=>{t.value&&(E?(i=t.value.style.transform,t.value.style.transform=""):t.value.style.transform=i)}),ne(()=>{e.modelValue&&(r.value=!0,v.value=!0,V())}),{afterEnter:B,afterLeave:I,beforeLeave:w,handleClose:L,onModalClick:k,close:$,doClose:n,onOpenAutoFocus:C,onCloseAutoFocus:h,onCloseRequested:me,onFocusoutPrevented:fe,titleId:a,bodyId:c,closed:f,style:_,overlayDialogStyle:N,rendered:v,visible:r,zIndex:b}},ho=["aria-label","aria-labelledby","aria-describedby"],Eo=R({name:"ElDialog",inheritAttrs:!1}),wo=R({...Eo,props:go,emits:bo,setup(e,{expose:t}){const l=e,m=Ne();eo({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},F(()=>!!m.title));const s=G("dialog"),d=D(),i=D(),a=D(),{visible:c,titleId:r,bodyId:f,style:v,overlayDialogStyle:b,rendered:p,zIndex:u,afterEnter:T,afterLeave:_,beforeLeave:N,handleClose:B,onModalClick:I,onOpenAutoFocus:w,onCloseAutoFocus:V,onCloseRequested:$,onFocusoutPrevented:L}=Co(l,d);Ve(de,{dialogRef:d,headerRef:i,bodyId:f,ns:s,rendered:p,style:v});const k=ue(I),P=F(()=>l.draggable&&!l.fullscreen);return t({visible:c,dialogContentRef:a}),(n,C)=>(O(),W(je,{to:n.appendTo,disabled:n.appendTo!=="body"?!1:!n.appendToBody},[g(He,{name:"dialog-fade",onAfterEnter:o(T),onAfterLeave:o(_),onBeforeLeave:o(N),persisted:""},{default:y(()=>[ze(g(o(io),{"custom-mask-event":"",mask:n.modal,"overlay-class":n.modalClass,"z-index":o(u)},{default:y(()=>[z("div",{role:"dialog","aria-modal":"true","aria-label":n.title||void 0,"aria-labelledby":n.title?void 0:o(r),"aria-describedby":o(f),class:S(`${o(s).namespace.value}-overlay-dialog`),style:re(o(b)),onClick:C[0]||(C[0]=(...h)=>o(k).onClick&&o(k).onClick(...h)),onMousedown:C[1]||(C[1]=(...h)=>o(k).onMousedown&&o(k).onMousedown(...h)),onMouseup:C[2]||(C[2]=(...h)=>o(k).onMouseup&&o(k).onMouseup(...h))},[g(o(Je),{loop:"",trapped:o(c),"focus-start-el":"container",onFocusAfterTrapped:o(w),onFocusAfterReleased:o(V),onFocusoutPrevented:o(L),onReleaseRequested:o($)},{default:y(()=>[o(p)?(O(),W(yo,Re({key:0,ref_key:"dialogContentRef",ref:a},n.$attrs,{center:n.center,"align-center":n.alignCenter,"close-icon":n.closeIcon,draggable:o(P),overflow:n.overflow,fullscreen:n.fullscreen,"show-close":n.showClose,title:n.title,"aria-level":n.headerAriaLevel,onClose:o(B)}),Ye({header:y(()=>[n.$slots.title?M(n.$slots,"title",{key:1}):M(n.$slots,"header",{key:0,close:o(B),titleId:o(r),titleClass:o(s).e("title")})]),default:y(()=>[M(n.$slots,"default")]),_:2},[n.$slots.footer?{name:"footer",fn:y(()=>[M(n.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","show-close","title","aria-level","onClose"])):x("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,ho)]),_:3},8,["mask","overlay-class","z-index"]),[[Ue,o(c)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["to","disabled"]))}});var ko=le(wo,[["__file","dialog.vue"]]);const To=qe(ko);const _o=z("p",null,"可以打开控制台查看logs",-1),Mo={class:"dialog-footer"},Uo={__name:"useTemplatePromise",setup(e){const t=D(null),l=oe({name:"张三",age:10}),m=oe({name:{required:!0,trigger:"blur",message:"请输入姓名"},age:{required:!0,trigger:"blur",message:"请输入年龄"}}),s=we(),d=async()=>{const c=await s.start("新增");console.log(c)},i=async c=>new Promise(r=>{c.validate((f,v)=>{f?(console.log("校验通过"),r(a())):(console.log("校验失败",v),r(!1))})}),a=()=>new Promise(c=>{setTimeout(()=>{c(!0)},1e5)});return(c,r)=>{const f=Ee,v=he,b=be,p=Ce,u=To;return O(),Y(Xe,null,[g(f,{onClick:d},{default:y(()=>[j("打开弹框")]),_:1}),g(o(s),null,{default:y(({promise:T,resolve:_,reject:N,args:B,isResolving:I})=>[g(u,{modelValue:!0,title:B[0],center:""},{footer:y(()=>[z("div",Mo,[g(f,{onClick:w=>_("cancel")},{default:y(()=>[j(" 取消 ")]),_:2},1032,["onClick"]),g(f,{type:"primary",disabled:I,onClick:w=>_(i(t.value))},{default:y(()=>[j(ae(I?"loading...":"确定"),1)]),_:2},1032,["disabled","onClick"])])]),default:y(()=>[_o,g(p,{ref_key:"formRef",ref:t,model:l,rules:m},{default:y(()=>[g(b,{label:"姓名",prop:"name"},{default:y(()=>[g(v,{modelValue:l.name,"onUpdate:modelValue":r[0]||(r[0]=w=>l.name=w)},null,8,["modelValue"])]),_:1}),g(b,{label:"年龄",prop:"age"},{default:y(()=>[g(v,{modelValue:l.age,"onUpdate:modelValue":r[1]||(r[1]=w=>l.age=w)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:2},1032,["title"])]),_:1})],64)}}};export{Uo as default};
